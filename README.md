### Вопрос 1  
Необходимо написать библиотеку/набор классов на С++ для сбора и
сохранения метрик в файл в текстовом виде.     
Метрики представляют собой именованные события, которые могут
происходить в произвольные моменты времени, с соответствующими
значениями заданного типа данных.

#### **Примеры метрик:**
* Средняя утилизация CPU за секунду, значения - вещественные
числа в диапазоне от О до N, где N - количество ядер процессора.
Значение О - полное отсутствие загруженности CPU, значение 2 -
100% загрузка двух ядер.
* Количество принятых НТТР запросов за секунду, значения - целые
числа от О до INT МАХ.

#### **Формат вывода: каждая запись метрик - отдельная строка: таймштамп, имена метрик и значения, записанные через пробел.**        
Пример фрагмента выходного файла:  
2025-06-01 15:00:01.653 "CPU" 0.97 "HTTP requests RPS" 42   
2025-06-01 15:00:02.653 "CPU" 1.12 "HTTP requests RPS" 30   
Для демонстрации использования написанного кода сделать
несколько своих примеров.      
#### **Требования:**
* Должна быть возможность добавлять новые типы метрик без
переписывания реализации.
* Запись метрик не должна блокировать потоки, в которых
происходят события.
* После записи метрик накопленные значения обнуляются.


# Описание классов системы сбора метрик

## Класс `MetricValue` (базовый абстрактный класс)
**Назначение**: Базовый интерфейс для хранения значений метрик любого типа.

### Виртуальные методы:
- `reset()` - сбрасывает значение метрики
- `toString()` - возвращает строковое представление значения
- `clone()` - создает копию объекта
- `hasValue()` - проверяет, содержит ли метрика актуальное значение (вместо обнуления используется флаг valid_)

## Класс `TypedMetricValue<T>` (шаблонный)
**Назначение**: Конкретная реализация для хранения значений определенного типа.

### Поля:
- `value_` (тип T) - хранимое значение
- `valid_` (bool) - флаг наличия актуального значения

### Методы:
- `reset()` - сбрасывает флаг valid_
- `toString()` - возвращает форматированное строковое представление
- `hasValue()` - возвращает состояние флага valid_
- `clone()` - создает копию объекта
- `setValue(T)` - устанавливает новое значение и флаг valid_

### Специальные методы:
- `toStringImpl(std::true_type)` - специализация для строк (добавляет кавычки)
- `toStringImpl(std::false_type)` - общий случай для других типов

## Класс `MetricsCollector`
**Назначение**: Сбор и управление набором метрик.

### Поля:
- `metrics_` (unordered_map) - хранилище метрик
- `mutex_` - мьютекс для потокобезопасности

### Методы:
- `record(name, value)` - добавляет/обновляет метрику
  - Потокобезопасный (использует lock_guard)
  - Автоматически определяет тип значения
  - Генерирует исключение при несоответствии типов

- `flushToFile(filename)` - записывает метрики в файл
  - Создает снимок текущих значений
  - Сбрасывает записанные метрики
  - Форматирует временную метку
  - Сортирует метрики по имени
  - Пропускает запись если нет данных

## Класс `AsyncMetricsWriter`
**Назначение**: Асинхронная запись метрик с заданным интервалом.

### Поля:
- `collector_` - экземпляр MetricsCollector
- `filename_` - путь к файлу лога
- `flushIntervalMs_` - интервал сброса (мс) Определяет периодичность автоматической записи метрик в файл, когда нет явных вызовов record().
- `running_` (atomic) - флаг работы потока
- `writerThread_` - поток для асинхронной записи
- `mutex_` - мьютекс для синхронизации
- `cv_` - условная переменная для управления потоком. Позволяет основному потоку уведомлять фоновый поток записи о необходимости выполнить сброс метрик. Дает возможность фоновому потоку "спать", пока не появится работа, вместо активного опроса.
- `scheduledFlush_` - флаг принудительного сброса

### Методы:
- `record(name, value)` - добавляет метрику
  - Потокобезопасный
  - Автоматически запускает процедуру сброса

- `run()` (private) - основная логика потока записи
  - Ожидает уведомления или истечения интервала
  - Выполняет сброс метрик в файл
  - Контролирует интервалы между записями

- Деструктор - корректно останавливает поток

## Особенности системы:
1. **Потокобезопасность**: Все операции защищены мьютексами
2. **Гибкость типов**: Поддержка любых типов метрик
3. **Эффективность**: Минимизация блокировок
4. **Надежность**: Гарантированная запись всех значений
5. **Удобство использования**: Простой интерфейс record()

## Пример потока данных:
1. Поток вызывает `record("CPU", 0.5)`
2. Данные сохраняются в `MetricsCollector`
3. Фоновый поток периодически записывает данные в файл
4. При уничтожении объекта выполняется финальная запись
